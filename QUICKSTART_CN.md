# VSifier WinForms 版本 - 快速开始指南

## 🚀 安装和运行

### 系统要求
- Windows 7 或更新版本
- .NET 8.0 运行时
- 管理员权限

### 第一步：以管理员身份运行

右键点击 `VSifier.exe` → "以管理员身份运行"

### 第二步：配置代理服务器

在 **Configuration** 标签页中：
1. 设置 **Proxy Host**（例如：`127.0.0.1` 或 `host.docker.internal`）
2. 设置 **Proxy Port**（例如：`7890`）
3. 选择 **Proxy Scheme**（SOCKS4、SOCKS5 或 HTTP）

### 第三步：配置目标进程

添加要拦截流量的进程：
- **方式1**：输入进程名称（如 `devenv.exe`，支持通配符 `msbuild*.exe`）
- **方式2**：输入进程 PID（进程编号）

### 第四步：保存配置（可选）

点击 **Save Config** 将配置保存到 JSON 文件。

配置文件路径：`%AppData%\VSifier\config.json`

### 第五步：启动代理

点击绿色的 **Start Proxy** 按钮开始拦截。

按钮变为红色 **Stop Proxy** 表示代理正在运行。

## 📊 监控和日志

### 状态栏
- **Status**：显示当前运行状态（Running/Stopped）
- **Stats**：实时统计信息
  - `Redirected`：重定向的连接数
  - `Proxied`：成功代理的连接数
  - `Failed`：失败的连接数

### Logs 标签页
- 显示所有操作的详细日志
- 包含时间戳和连接详情
- 点击 **Clear Logs** 清空日志

## 💾 配置文件

### 默认位置
`C:\Users\<username>\AppData\Roaming\VSifier\config.json`

### 配置示例
```json
{
  "proxy": {
    "host": "127.0.0.1",
    "port": 7890,
    "scheme": "socks5"
  },
  "targeting": {
    "processNames": [
      "devenv.exe",
      "blend.exe",
      "msbuild*.exe"
    ],
    "extraPids": [
      1234,
      5678
    ]
  }
}
```

### 修改配置

**方式1**：通过 UI 修改，点击 "Save Config" 保存

**方式2**：手动编辑 JSON 文件，然后点击 "Load Config" 刷新

## 🔧 系统托盘

- **最小化**：点击窗口关闭按钮会最小化到托盘
- **还原**：双击托盘图标或点击"Show"
- **退出**：在托盘右键菜单选择"Exit"（需先停止代理）

## ⚠️ 常见问题

### Q: 启动时显示"需要管理员权限"

**A**: 右键点击可执行文件 → "以管理员身份运行"

### Q: 看不到配置文件

**A**: 
1. 按 `Win + R`
2. 输入 `%AppData%` 并回车
3. 找到 `VSifier` 文件夹

### Q: 代理不工作

**检查清单**：
- [ ] 已以管理员身份运行
- [ ] 代理服务器地址和端口正确
- [ ] 进程名称拼写正确
- [ ] WinDivert.dll 和 WinDivert64.sys 在同一目录
- [ ] 查看日志中是否有"skip"消息

### Q: 如何使用通配符

**支持的通配符**：
- `*` 匹配任意字符序列（如 `msbuild*.exe`）
- `?` 匹配单个字符（如 `test?.exe`）

**例子**：
- `devenv.exe` → 精确匹配
- `servicehub*.exe` → 匹配 servicehub 开头的所有进程
- `vs?2022.exe` → 匹配 vs + 任意字符 + 2022.exe

### Q: 如何恢复默认配置

**方法**：
1. 找到配置文件：`%AppData%\VSifier\config.json`
2. 删除该文件
3. 重启应用
4. 应用会自动生成默认配置

## 📝 功能说明

### 代理协议

| 协议 | 描述 | 适用场景 |
|------|------|---------|
| **SOCKS4** | 基础 SOCKS 协议 | 对等级要求不高的场景 |
| **SOCKS5** | 增强型 SOCKS 协议 | 大多数代理服务器支持 |
| **HTTP** | HTTP CONNECT 隧道 | HTTP 代理服务器 |

### 进程匹配

应用支持以下进程选择方式：

1. **精确匹配**：`devenv.exe`
2. **通配符匹配**：`msbuild*.exe`、`vs?2022.exe`
3. **PID 指定**：直接输入进程ID

### 本地流量自动绕过

以下地址不会通过代理：
- 127.0.0.1 (本地回环)
- 10.0.0.0/8 (内网)
- 172.16.0.0/12 (内网)
- 192.168.0.0/16 (内网)
- 169.254.0.0/16 (链接本地)
- localhost
- 本机计算机名

## 🔐 安全建议

1. **仅在信任的网络中使用**
2. **启用代理服务器身份验证**（如果可用）
3. **定期检查日志** 查看异常连接
4. **不要将配置文件与他人共享** 可能包含敏感信息

## 🐛 故障排除

### 查看详细日志

1. 打开 **Logs** 标签页
2. 寻找包含 `[Error]` 或 `[skip]` 的日志行
3. 理解日志含义并采取相应行动

### 常见日志信息

```
[skip] 进程 -> 目标 (Process not in allow-list)
```
含义：该进程不在白名单中，连接被跳过。

```
[proxied] 目标 via socks5://...
```
含义：连接成功通过代理转发。

```
[Error] ...
```
含义：发生错误，查看错误详情。

## 📖 更多信息

- 详细说明：见 `README_CN.md`
- 迁移指南：见 `MIGRATION_GUIDE_CN.md`
- 项目主页：[GitHub - VSifier](https://github.com/maikebing/VSifier)

## 💡 技巧

### 快速切换配置

1. 在 UI 中配置好参数
2. 点击 "Save Config"
3. 可以在 JSON 文件中手动编辑以创建多个配置
4. 使用文件浏览器快速切换配置文件

### 调试代理连接

1. 打开 **Logs** 标签页
2. 启动代理
3. 从目标进程访问网络资源
4. 实时查看日志中的连接信息

### 性能优化

1. 减少进程匹配规则数量
2. 避免过宽泛的通配符模式
3. 定期清空日志避免内存占用过多

---

**版本**：2.0 (WinForms)  
**最后更新**：2024年  
**许可证**：按项目原许可证
